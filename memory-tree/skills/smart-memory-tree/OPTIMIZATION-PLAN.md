# 记忆树优化方案 v2.0

## 📋 背景
基于 Moltbook 用户反馈和实际使用体验，对现有记忆树系统提出以下优化建议。

---

## 🔍 用户反馈汇总

### 1. **自动化程度不够**
**问题：** 用户需要手动执行 `save-memory.js` 来保存记忆
**反馈：** "为什么不能每次对话结束自动保存？"
**建议：** 实现自动保存机制

### 2. **记忆分类混乱**
**问题：** 所有记忆都堆在 `30-VAULT.md` 中，难以查找
**反馈：** "找个之前的想法翻半天"
**建议：** 引入智能分类和标签系统

### 3. **缺少搜索功能**
**问题：** 无法快速定位特定记忆
**反馈：** "有搜索吗？我想找之前说的 XXX"
**建议：** 添加关键词搜索和语义搜索

### 4. **记忆热度形同虚设**
**问题：** 热度追踪没有实际作用
**反馈：** "低热度提醒了然后呢？"
**建议：** 热度应触发实际动作（如归档、提示删除）

### 5. **经验进化流程复杂**
**问题：** 从 pending 到 approved 流程繁琐
**反馈：** "为什么不能自动审核？"
**建议：** 简化审核流程，引入自动进化机制

---

## 💡 优化方案

### 方案 A：轻量级改进（推荐优先实施）

#### 1. 自动保存触发器
```javascript
// 在每次对话结束时自动调用
process.on('exit', () => {
  saveMemory();
});

// 或定时保存（每 30 分钟）
setInterval(() => {
  saveMemory();
}, 1800000);
```

#### 2. 简化分类结构
```
memory-tree/
├── 00-CORE.md          # 核心记忆（不变）
├── 10-DAILY/           # 按日期自动归档
│   ├── 2026-02.md
│   └── 2026-03.md
├── 20-TOPICS/          # 主题分类
│   ├── projects.md
│   ├── ideas.md
│   └── people.md
├── 30-VAULT.md         # 临时存储（每周清理）
└── 40-EVOLUTION-LOG/
    └── pending.md      # 待审核经验
```

#### 3. 基础搜索功能
```javascript
// 简单的关键词搜索
function searchMemory(keyword) {
  const files = getAllMemoryFiles();
  return files.filter(file => 
    file.content.includes(keyword)
  );
}

// 使用示例
searchMemory('OpenClaw'); // 返回所有提到 OpenClaw 的记忆
```

#### 4. 热度自动归档
```javascript
// 热度 < 10 且超过 7 天的记忆自动归档
if (heat < 10 && daysSinceLastMention > 7) {
  moveToArchive(memory);
  notifyUser('记忆已归档：' + memory.title);
}
```

---

### 方案 B：深度重构（长期目标）

#### 1. 语义搜索（需要嵌入模型）
- 使用本地嵌入模型（如 nomic-embed-text）
- 支持"找类似的记忆"功能
- 基于语义相似度推荐相关记忆

#### 2. 智能标签系统
- 自动从记忆内容提取关键词作为标签
- 支持手动添加/删除标签
- 基于标签的聚类和可视化

#### 3. 记忆图谱可视化
- 用图形展示记忆之间的关联
- 点击节点可查看详情
- 支持时间线视图

#### 4. 自动进化机制
- 当某条经验被引用超过 N 次，自动升级为"核心记忆"
- 当某条记忆连续 M 天未被提及，自动提示删除或归档
- 基于使用频率自动调整记忆权重

---

## 📊 实施优先级

| 优先级 | 功能 | 难度 | 预期收益 |
|--------|------|------|----------|
| 🔥 P0 | 自动保存机制 | 低 | 高 - 解决最大痛点 |
| 🔥 P0 | 简化分类结构 | 中 | 高 - 立即可用 |
| ⚡ P1 | 基础关键词搜索 | 中 | 中 - 提升效率 |
| ⚡ P1 | 热度自动归档 | 低 | 中 - 减少 clutter |
| 🌟 P2 | 语义搜索 | 高 | 高 - 差异化功能 |
| 🌟 P2 | 记忆图谱可视化 | 高 | 中 - 提升体验 |

---

## 🛠️ 立即可执行的步骤

### 步骤 1：启用自动保存（10 分钟）
1. 修改 `save-memory.js`，添加定时保存逻辑
2. 在 OpenClaw 的 heartbeat 中集成保存调用

### 步骤 2：重构目录结构（30 分钟）
1. 创建 `10-DAILY/` 和 `20-TOPICS/` 文件夹
2. 迁移现有记忆到新结构
3. 更新索引文件

### 步骤 3：添加搜索功能（1 小时）
1. 实现基础关键词搜索
2. 添加命令行交互：`node index.js search "关键词"`
3. 搜索结果高亮显示

### 步骤 4：优化热度系统（30 分钟）
1. 修改热度计算逻辑
2. 添加自动归档规则
3. 生成每周记忆简报

---

## 📈 成功指标

- **自动保存率：** 100%（不再丢失记忆）
- **搜索响应时间：** < 1 秒
- **记忆查找效率：** 从平均 5 分钟降至 30 秒
- **用户满意度：** Moltbook 正面反馈增加

---

## 🎯 下一步行动

1. **立即执行：** 方案 A 的步骤 1-2（今天完成）
2. **本周完成：** 方案 A 的步骤 3-4
3. **本月探索：** 方案 B 的可行性研究
4. **长期愿景：** 构建智能记忆管理系统

---

**创建时间：** 2026-02-27  
**基于：** Moltbook 用户反馈 + 实际使用体验  
**状态：** 待审核 → 执行中
