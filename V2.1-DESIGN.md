# V2.1 è¯­ä¹‰å¤æ´»åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## èƒŒæ™¯

åœ¨è®°å¿†æ ‘ç³»ç»Ÿä¸­ï¼Œå½“èŠ‚ç‚¹çƒ­åº¦è¡°å‡åˆ°ä¸€å®šç¨‹åº¦åä¼šè¢«å½’æ¡£ã€‚ç„¶è€Œï¼ŒæŸäº›å½’æ¡£çš„è®°å¿†å¯èƒ½åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­é‡æ–°å˜å¾—ç›¸å…³ã€‚V2.1 "è¯­ä¹‰å¤æ´»" åŠŸèƒ½æ—¨åœ¨é€šè¿‡è¯­ä¹‰ç›¸ä¼¼åº¦æ£€æµ‹ï¼Œæ™ºèƒ½åœ°"å¤æ´»"è¿™äº›è¢«å½’æ¡£çš„è®°å¿†èŠ‚ç‚¹ã€‚

## æ ¸å¿ƒæ¦‚å¿µ

### 1. è®°å¿†æŒ‡çº¹ (Fingerprint)

æ¯ä¸ªè®°å¿†èŠ‚ç‚¹å†…å®¹ç”Ÿæˆä¸€ä¸ªå”¯ä¸€æŒ‡çº¹ï¼Œç”¨äºå¿«é€Ÿæ¯”å¯¹ã€‚

- **å½“å‰å®ç°**: ä½¿ç”¨ `crypto.createHash('md5')` ç”Ÿæˆ MD5 å“ˆå¸Œä½œä¸ºæ¨¡æ‹ŸæŒ‡çº¹
- **æœªæ¥ä¼˜åŒ–**: æ›¿æ¢ä¸ºå‘é‡åµŒå…¥æ¨¡å‹ (å¦‚ nomic-embed-text)

```javascript
function generateFingerprint(content) {
  return crypto.createHash('md5').update(content).digest('hex');
}
```

### 2. ç›¸ä¼¼åº¦è®¡ç®— (Similarity)

è®¡ç®—å½“å‰ä¸Šä¸‹æ–‡ä¸å½’æ¡£èŠ‚ç‚¹ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼åº¦ã€‚

- **å½“å‰å®ç°**: å…³é”®è¯é‡åˆåº¦ (Jaccard ç›¸ä¼¼åº¦)
- **æœªæ¥ä¼˜åŒ–**: ä½™å¼¦ç›¸ä¼¼åº¦ + å‘é‡åµŒå…¥

```javascript
function calculateSimilarity(keywordsA, keywordsB) {
  // è®¡ç®—ä¸¤ä¸ªå…³é”®è¯æ•°ç»„çš„é‡åˆåº¦ (0-1)
  const setA = new Set(keywordsA);
  const setB = new Set(keywordsB);
  const intersection = [...setA].filter(k => setB.has(k));
  const union = new Set([...setA, ...setB]);
  return intersection.length / union.size;
}
```

### 3. å¤æ´»é€»è¾‘ (Resurrection)

å½“æ£€æµ‹åˆ°é«˜ç›¸ä¼¼åº¦æ—¶ï¼Œè§¦å‘å½’æ¡£èŠ‚ç‚¹çš„å¤æ´»æµç¨‹ã€‚

- **é˜ˆå€¼**: ç›¸ä¼¼åº¦ > 0.85
- **è¡Œä¸º**: å°†å½’æ¡£èŠ‚ç‚¹è·¯å¾„è¿”å›ï¼Œæç¤ºç”¨æˆ·æ˜¯å¦æ¢å¤

## æµç¨‹å›¾ (æ–‡å­—æè¿°)

```
[ç”¨æˆ·æ“ä½œ/ä¸Šä¸‹æ–‡å˜åŒ–]
    â†“
[æå–å½“å‰ä¸Šä¸‹æ–‡å…³é”®è¯]
    â†“
[éå† archive_metadata.json]
    â†“
[å¯¹æ¯ä¸ªå½’æ¡£èŠ‚ç‚¹è®¡ç®—ç›¸ä¼¼åº¦]
    â†“
[ç›¸ä¼¼åº¦ > 0.85?]
    â”œâ”€ æ˜¯ â†’ [åŠ å…¥å¾…å¤æ´»åˆ—è¡¨]
    â””â”€ å¦ â†’ [è·³è¿‡]
    â†“
[è¿”å›å¾…å¤æ´»èŠ‚ç‚¹åˆ—è¡¨]
    â†“
[æç¤ºç”¨æˆ·æ˜¯å¦æ¢å¤]
```

## æ–‡ä»¶ç»“æ„

```
openclaw-memory-tree/
â”œâ”€â”€ heat-tracker.js       # æ ¸å¿ƒé€»è¾‘ (æ–°å¢å‡½æ•°)
â”œâ”€â”€ archive_metadata.json # å½’æ¡£èŠ‚ç‚¹å…ƒæ•°æ® (è‡ªåŠ¨ç”Ÿæˆ)
â”œâ”€â”€ test-resurrection.js  # æµ‹è¯•è„šæœ¬
â””â”€â”€ V2.1-DESIGN.md        # æœ¬è®¾è®¡æ–‡æ¡£
```

## TODO

- [x] å®ç° `generateFingerprint(content)` å‡½æ•°
- [x] å®ç° `calculateSimilarity(keywordsA, keywordsB)` å‡½æ•°
- [x] å®ç° `checkResurrection(currentContext, archiveMetadata)` å‡½æ•°
- [x] ä¿®æ”¹ `pruneOldMemories` ä»¥ä¿å­˜å½’æ¡£å…ƒæ•°æ®
- [x] åˆ›å»ºæµ‹è¯•è„šæœ¬ `test-resurrection.js`
- [ ] é›†æˆåˆ° `index.js` ä¸»æµç¨‹
- [ ] æ›¿æ¢ MD5 ä¸ºçœŸå®å‘é‡åµŒå…¥æ¨¡å‹
- [ ] å®ç°ç”¨æˆ·äº¤äº’å¼å¤æ´»ç¡®è®¤
- [ ] æ·»åŠ å¤æ´»å†å²è®°å½•

## æµ‹è¯•ç¤ºä¾‹

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
```bash
node test-resurrection.js
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸ”¥ å‘ç°å¾…å¤æ´»è®°å¿†ï¼š/path/to/archived/node
```

## ç‰ˆæœ¬å†å²

- **v2.1-alpha**: åˆå§‹åŸå‹ (MD5 + å…³é”®è¯é‡åˆåº¦)
- **v2.1-beta**: (è®¡åˆ’) å‘é‡åµŒå…¥ + ä½™å¼¦ç›¸ä¼¼åº¦
- **v2.1-rc**: (è®¡åˆ’) ç”¨æˆ·äº¤äº’ + å¤æ´»å†å²
